#!/usr/bin/env bash
basedir=$(dirname "$(readlink -f "$0" || echo "$0")")

# Fix for Windows environments
case "$(uname -s)" in
    CYGWIN*|MINGW*|MSYS*)
        if command -v cygpath > /dev/null 2>&1; then
            basedir=$(cygpath -w "$basedir")
        fi
        ;;
esac

# Ensure the script has execute permissions
chmod +x "$0" 2>/dev/null || true

# Path to the vite.js file
vite_js_path="$basedir/../vite/bin/vite.js"

# Check if the vite.js file exists and is readable
if [ ! -f "$vite_js_path" ]; then
    echo "Error: vite.js not found at $vite_js_path" >&2
    exit 1
fi

# Ensure vite.js has read permissions
chmod +r "$vite_js_path" 2>/dev/null || true

# Try to execute with local node if available
if [ -x "$basedir/node" ]; then
    chmod +x "$basedir/node" 2>/dev/null || true
    exec "$basedir/node" "$vite_js_path" "$@"
else
    # Fall back to system node
    exec node "$vite_js_path" "$@"
fi